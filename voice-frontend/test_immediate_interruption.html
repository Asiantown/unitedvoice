<\!DOCTYPE html>
<html>
<head>
    <title>Test Immediate Audio Interruption</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #222; color: white; }
        button { padding: 10px 20px; margin: 10px; font-size: 16px; }
        #status { margin: 20px 0; padding: 10px; background: #333; border-radius: 5px; }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
    </style>
</head>
<body>
    <h1>Test Immediate Audio Interruption</h1>
    <p>This test verifies that audio stops IMMEDIATELY when spacebar is pressed.</p>
    
    <button onclick="playLongAudio()">Play 10-Second Test Audio</button>
    <button onclick="checkInterruption()">Check Interruption Status</button>
    
    <div id="status">Press "Play Test Audio" then press SPACEBAR to test interruption</div>
    
    <h3>Instructions:</h3>
    <ol>
        <li>Click "Play 10-Second Test Audio"</li>
        <li>While audio is playing, press SPACEBAR</li>
        <li>Audio should stop IMMEDIATELY (within milliseconds)</li>
    </ol>
    
    <script>
        let testAudio = null;
        let audioStartTime = 0;
        let interruptionTime = 0;
        
        function playLongAudio() {
            // Create a test audio that plays for 10 seconds
            const audioContext = new AudioContext();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 440; // A4 note
            gainNode.gain.value = 0.3;
            
            // Create HTML audio element for testing
            testAudio = new Audio();
            testAudio.src = 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSl+z/Dhkz0JGWq+8uCfTg0OU6zn4LFaGgU';
            
            audioStartTime = Date.now();
            testAudio.play();
            
            document.getElementById('status').innerHTML = 
                '<span class="success">Audio playing... Press SPACEBAR to interrupt\!</span>';
            
            testAudio.onended = () => {
                const duration = (Date.now() - audioStartTime) / 1000;
                if (duration < 9) {
                    document.getElementById('status').innerHTML = 
                        `<span class="success">✅ Audio interrupted after ${duration.toFixed(2)} seconds\!</span>`;
                } else {
                    document.getElementById('status').innerHTML = 
                        '<span class="error">Audio ended naturally (not interrupted)</span>';
                }
            };
        }
        
        function checkInterruption() {
            if (testAudio && \!testAudio.paused) {
                document.getElementById('status').innerHTML = 
                    '<span class="error">Audio is still playing\!</span>';
            } else if (testAudio && testAudio.paused) {
                document.getElementById('status').innerHTML = 
                    '<span class="success">✅ Audio is stopped\!</span>';
            } else {
                document.getElementById('status').innerHTML = 
                    'No audio to check';
            }
        }
        
        // Listen for spacebar
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && testAudio && \!testAudio.paused) {
                e.preventDefault();
                interruptionTime = Date.now();
                const responseTime = interruptionTime - audioStartTime;
                
                // Simulate what the app should do
                testAudio.pause();
                testAudio.currentTime = 0;
                
                document.getElementById('status').innerHTML = 
                    `<span class="success">✅ INTERRUPTED\! Response time: ${responseTime}ms</span>`;
            }
        });
    </script>
</body>
</html>
