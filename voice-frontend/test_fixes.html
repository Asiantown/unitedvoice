<\!DOCTYPE html>
<html>
<head>
    <title>Test Fixes</title>
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
</head>
<body>
    <h1>Testing Voice Agent Fixes</h1>
    <div id="status">Connecting...</div>
    <div id="messages"></div>
    <button onclick="testHello()">Say Hello</button>
    
    <script>
        const socket = io('http://localhost:8000');
        const messagesDiv = document.getElementById('messages');
        const statusDiv = document.getElementById('status');
        let messageCount = {};
        
        socket.on('connect', () => {
            statusDiv.innerHTML = '✅ Connected - Waiting for greeting...';
            setTimeout(() => {
                if (messagesDiv.children.length === 0) {
                    statusDiv.innerHTML = '✅ Good\! No auto-greeting (as expected)';
                }
            }, 2000);
        });
        
        socket.on('agent_response', (data) => {
            const key = data.text;
            messageCount[key] = (messageCount[key] || 0) + 1;
            
            const msgDiv = document.createElement('div');
            msgDiv.innerHTML = `Agent: ${data.text} (count: ${messageCount[key]})`;
            msgDiv.style.color = messageCount[key] > 1 ? 'red' : 'green';
            messagesDiv.appendChild(msgDiv);
            
            if (messageCount[key] > 1) {
                statusDiv.innerHTML = '❌ ERROR: Duplicate message detected\!';
            }
        });
        
        function testHello() {
            // Simulate user saying hello
            const audioData = btoa('fake audio data');
            socket.emit('audio_data', {
                audio: audioData,
                format: 'webm'
            });
            statusDiv.innerHTML = 'Sent hello...';
        }
    </script>
</body>
</html>
